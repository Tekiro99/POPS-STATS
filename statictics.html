<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <title>PopsCoin ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0c10;
      --panel: #11141a;
      --panel-2: #0d1117;
      --text: #e6e8eb;
      --muted: #9aa4b2;
      --accent: #7c3aed; /* violet */
      --accent-2: #22d3ee; /* cyan */
      --good: #10b981;
      --bad: #ef4444;
      --warn: #f59e0b;
      --card-r: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.03);
      --glass: rgba(255,255,255,.04);
    }
    * { box-sizing: border-box; }
    html, body { margin:0; background: var(--bg); color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    a { color: var(--accent-2); text-decoration: none; }
    header { padding: 24px 16px 8px; position: sticky; top: 0; background: linear-gradient(180deg, rgba(10,12,16,.95), rgba(10,12,16,.65) 60%, transparent); backdrop-filter: blur(8px); z-index: 5; }
    .title { display:flex; align-items:center; gap:14px; }
    .logo { width:36px; height:36px; background: radial-gradient(120% 120% at 30% 30%, var(--accent), var(--accent-2)); border-radius:10px; box-shadow: var(--shadow); }
    h1 { font-family: Orbitron, Inter, sans-serif; letter-spacing: .5px; font-size: clamp(22px, 2.6vw, 32px); margin:0; }
    .sub { color: var(--muted); font-size: 12px; }
    .wrap { padding: 8px 16px 40px; max-width: 1300px; margin: 0 auto; }
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 14px; }
    .card { background: linear-gradient(180deg, var(--panel), var(--panel-2)); border: 1px solid rgba(255,255,255,.06); border-radius: var(--card-r); box-shadow: var(--shadow); padding: 14px; }
    .kpis { grid-column: 1 / -1; display:grid; grid-template-columns: repeat(12, 1fr); gap: 14px; }
    .kpi { grid-column: span 6; display:flex; flex-direction:column; gap:6px; padding:14px; background: linear-gradient(180deg, rgba(124,58,237,.12), rgba(34,211,238,.09)); border: 1px solid rgba(124,58,237,.25); border-radius: 16px; }
    .kpi b { font-size: clamp(18px, 3vw, 28px); font-variant-numeric: tabular-nums; }
    .kpi span { color: var(--muted); font-size: 12px; }
    .charts { grid-column: 1 / -1; display:grid; grid-template-columns: repeat(12, 1fr); gap: 14px; }
    .charts .card { grid-column: span 12; }
    @media(min-width: 780px) {
        .kpi { grid-column: span 3; }
        .charts .card.big { grid-column: span 8; }
        .charts .card.side { grid-column: span 4; }
        .charts .card.half { grid-column: span 6; }
    }
    canvas { width: 100% !important; height: auto !important; }
    .leaders { grid-column: 1 / -1; display:grid; grid-template-columns: repeat(12, 1fr); gap: 14px; }
    .leader { grid-column: span 12; }
    @media(min-width: 900px) { .leader { grid-column: span 4; } }
    .leader h3 { margin: 2px 0 8px; font-size: 14px; color: var(--muted); }
    .leader ol { margin:0; padding:0 0 0 18px; display:flex; flex-direction:column; gap:6px; }
    .leader li { padding: 8px 10px; background: var(--glass); border-radius: 12px; border: 1px solid rgba(255,255,255,.06); }
    .table { grid-column: 1 / -1; overflow:auto; }
    table { width:100%; border-collapse: collapse; font-size: 13px; }
    th, td { padding: 10px 8px; text-align: left; border-bottom:1px solid rgba(255,255,255,.06); }
    th { position: sticky; top: 64px; background: var(--panel); z-index: 3; cursor: pointer; user-select: none; }
    tr:hover td { background: rgba(124,58,237,.05); }
    .badge { padding: 4px 8px; border-radius: 999px; font-size: 11px; border: 1px solid rgba(255,255,255,.14); }
    .good { color: var(--good); }
    .bad { color: var(--bad); }
    .warn { color: var(--warn); }
    .footer { margin-top: 28px; color: var(--muted); font-size: 12px; }
    .row { display:flex; gap: 10px; align-items:center; flex-wrap: wrap; }
    .pill { display:inline-flex; gap:8px; align-items:center; padding:8px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.06); background: var(--panel-2); font-size:12px; }
    .search { flex:1; min-width: 180px; }
    .search input { width:100%; padding:10px 12px; border-radius: 12px; background: var(--panel); color:var(--text); border:1px solid rgba(255,255,255,.08); outline:none; }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <div class="logo"></div>
      <div>
        <h1>PopsCoin ‚Äî —Å–≤–æ–¥–∫–∞ –ø–æ –∏–≥—Ä–æ–∫–∞–º</h1>
        <div class="sub">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç ¬∑ –æ–±–Ω–æ–≤–ª–µ–Ω–æ: 14.08.2025 20:00</div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <section class="grid kpis">
      <div class="kpi"><span>–ò–≥—Ä–æ–∫–æ–≤</span><b id="kpi_players"></b></div>
      <div class="kpi"><span>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS</span><b id="kpi_earn_pcs"></b></div>
      <div class="kpi"><span>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS</span><b id="kpi_spent_pcs"></b></div>
      <div class="kpi"><span>–ß–∏—Å—Ç—ã–π PCS</span><b id="kpi_net_pcs"></b></div>
      <div class="kpi"><span>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ Popsium</span><b id="kpi_earn_psm"></b></div>
      <div class="kpi"><span>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ Popsium</span><b id="kpi_spent_psm"></b></div>
      <div class="kpi"><span>–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤</span><b id="kpi_kills"></b></div>
      <div class="kpi"><span>–°–º–µ—Ä—Ç–∏</span><b id="kpi_deaths"></b></div>
    </section>

    <section class="charts grid">
      <div class="card big">
        <h2 style="margin:4px 0 10px">Net PCS –ø–æ –∏–≥—Ä–æ–∫–∞–º</h2>
        <canvas id="netChart"></canvas>
      </div>
      <div class="card side">
        <h2 style="margin:4px 0 10px">Popsium ‚Äî –≤–∫–ª–∞–¥ –∏–≥—Ä–æ–∫–æ–≤</h2>
        <canvas id="popsiumPie"></canvas>
      </div>
      <div class="card half">
        <h2 style="margin:4px 0 10px">PCS: –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ vs –ø–æ—Ç—Ä–∞—á–µ–Ω–æ</h2>
        <canvas id="stackedPCS"></canvas>
      </div>
      <div class="card half">
        <h2 style="margin:4px 0 10px">–°–≤—è–∑—å: –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS –∏ –ø–æ–±–µ–¥—ã</h2>
        <canvas id="scatterEarnKills"></canvas>
      </div>
      <div class="card">
        <h2 style="margin:4px 0 10px">–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
        <canvas id="activityChart"></canvas>
      </div>
    </section>

    <section class="leaders grid">
      <div class="leader card">
        <h3>–õ–∏–¥–µ—Ä—ã ‚Äî –ß–∏—Å—Ç—ã–π PCS</h3>
        <ol id="lead_net"></ol>
      </div>
      <div class="leader card">
        <h3>–õ–∏–¥–µ—Ä—ã ‚Äî –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS</h3>
        <ol id="lead_earn"></ol>
      </div>
      <div class="leader card">
        <h3>–õ–∏–¥–µ—Ä—ã ‚Äî Popsium</h3>
        <ol id="lead_psm"></ol>
      </div>
      <div class="leader card">
        <h3>–õ–∏–¥–µ—Ä—ã ‚Äî –ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤</h3>
        <ol id="lead_kills"></ol>
      </div>
      <div class="leader card">
        <h3>–õ–∏–¥–µ—Ä—ã ‚Äî –î–æ–±—ã—á–∞ —Ä—É–¥—ã</h3>
        <ol id="lead_ores"></ol>
      </div>
      <div class="leader card">
        <h3>–õ–∏–¥–µ—Ä—ã ‚Äî –ü–æ–∫—É–ø–∫–∏</h3>
        <ol id="lead_buy"></ol>
      </div>
      <div class="leader card">
        <h3>–õ–∏–¥–µ—Ä—ã ‚Äî –í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ</h3>
        <ol id="lead_drink"></ol>
      </div>
      <div class="leader card">
        <h3>–õ–∏–¥–µ—Ä—ã ‚Äî –ó–∞—Ç–æ—á–∫–∏</h3>
        <ol id="lead_ench"></ol>
      </div>
      <div class="leader card">
        <h3>–õ–∏–¥–µ—Ä—ã ‚Äî K/D</h3>
        <ol id="lead_kd"></ol>
      </div>
      <div class="leader card">
        <h3>–õ–∏–¥–µ—Ä—ã ‚Äî –ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
        <ol id="lead_act"></ol>
      </div>
      <div class="leader card">
        <h3>–õ–∏–¥–µ—Ä—ã ‚Äî –ü–æ–ª–æ–º–∫–∏ (–±–æ–ª—å—à–µ)</h3>
        <ol id="lead_break"></ol>
      </div>
    </section>

    <section class="table card">
      <div class="row" style="margin-bottom:8px">
        <div class="pill">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –Ω–∞–∂–º–∏ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫</div>
        <div class="search"><input id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–≥—Ä–æ–∫—É‚Ä¶"/></div>
        <button id="export" class="pill" title="–≠–∫—Å–ø–æ—Ä—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ CSV">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
      </div>
      <div style="overflow:auto;">
      <table id="statTable">
        <thead id="thead"></thead>
        <tbody id="tbody"></tbody>
      </table>
      </div>
      <div class="footer">* K/D = –ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤ / –°–º–µ—Ä—Ç–∏ (–µ—Å–ª–∏ —Å–º–µ—Ä—Ç–µ–π 0 ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º ‚àû).</div>
    </section>

    <div class="footer">–û—Ç—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ ¬∑ ¬© PopsCoin Analytics</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script>
    const CHART = "{\"players\":[\"Grey\",\"Mizukaze\",\"Toshiro\",\"–õ–µ–∫—Åüêæ\",\"Soranami\",\"Elvina\",\"–î–∂–æ–Ω—Å–æ–Ω—é–∫\",\"Camalik\",\"MaryKat\",\"–≠–º–∏–Ω\",\"–°–∫–∞–π–ª–µ—Ä\",\"–ú–∏–¥–≤–µ–¥—å\",\"Didier\"],\"earned_popscoin\":[2197,534,1105,1790,1579,2102,1080,994,505,568,932,1719,699],\"spent_popscoin\":[3954,1469,1527,3640,3039,3499,1671,1450,763,1230,1482,2409,1357],\"net_popscoin\":[-1757,-935,-422,-1850,-1460,-1397,-591,-456,-258,-662,-550,-690,-658],\"earned_popsium\":[16,0,0,20,32,13,0,0,0,0,0,0,0],\"spent_popsium\":[14,0,2,17,16,9,0,0,0,0,0,0,0],\"ores_broken\":[186,48,90,164,152,183,83,76,37,38,73,162,68],\"purchases_made\":[29,7,9,28,26,27,10,10,5,6,10,18,8],\"drinks_in_tavern\":[160,46,122,166,154,167,87,94,26,16,58,142,62],\"promocodes_used\":[10,1,4,12,5,7,3,3,1,1,4,8,4],\"enchants_used\":[12,4,5,11,7,10,3,4,2,3,4,9,3],\"items_broken\":[7,2,3,7,6,8,2,3,1,0,2,5,2],\"enemies_defeated\":[64,21,47,75,68,71,31,35,15,14,23,52,25],\"deaths\":[4,2,3,7,3,6,2,3,1,0,2,4,2],\"kd_ratio\":[\"16.0\",\"10.5\",\"15.67\",\"10.71\",\"22.67\",\"11.83\",\"15.5\",\"11.67\",\"15.0\",\"‚àû\",\"11.5\",\"13.0\",\"12.5\"],\"activity_score\":[100.0,18.7,62.6,97.1,92.4,97.3,34.5,39.4,11.4,8.2,28.3,83.0,31.3]}";
    const TOTALS = "{\"players\":13,\"earned_popscoin\":14400,\"spent_popscoin\":25591,\"net_popscoin\":-11191,\"earned_popsium\":81,\"spent_popsium\":58,\"enemies_defeated\":548,\"deaths\":36,\"ores_broken\":1362,\"purchases_made\":208,\"drinks_in_tavern\":1300,\"enchants_used\":77,\"promocodes_used\":59,\"items_broken\":48}";
    const LEADERS = "{\"net_popscoin\":[[\"Grey\",-1757],[\"–õ–µ–∫—Åüêæ\",-1850],[\"Elvina\",-1397],[\"Soranami\",-1460],[\"–ú–∏–¥–≤–µ–¥—å\",-690]],\"earned_popscoin\":[[\"Grey\",2197],[\"Elvina\",2102],[\"–õ–µ–∫—Åüêæ\",1790],[\"–ú–∏–¥–≤–µ–¥—å\",1719],[\"Soranami\",1579]],\"earned_popsium\":[[\"Soranami\",32],[\"–õ–µ–∫—Åüêæ\",20],[\"Grey\",16],[\"Elvina\",13],[\"Toshiro\",0]],\"enemies_defeated\":[[\"–õ–µ–∫—Åüêæ\",75],[\"Elvina\",71],[\"Soranami\",68],[\"Grey\",64],[\"–ú–∏–¥–≤–µ–¥—å\",52]],\"ores_broken\":[[\"Grey\",186],[\"Elvina\",183],[\"–õ–µ–∫—Åüêæ\",164],[\"–ú–∏–¥–≤–µ–¥—å\",162],[\"Soranami\",152]],\"purchases_made\":[[\"Grey\",29],[\"–õ–µ–∫—Åüêæ\",28],[\"Elvina\",27],[\"Soranami\",26],[\"–ú–∏–¥–≤–µ–¥—å\",18]],\"drinks_in_tavern\":[[\"Elvina\",167],[\"–õ–µ–∫—Åüêæ\",166],[\"Grey\",160],[\"Soranami\",154],[\"–ú–∏–¥–≤–µ–¥—å\",142]],\"enchants_used\":[[\"Grey\",12],[\"–õ–µ–∫—Åüêæ\",11],[\"Elvina\",10],[\"–ú–∏–¥–≤–µ–¥—å\",9],[\"Soranami\",7]],\"items_broken\":[[\"Elvina\",8],[\"Grey\",7],[\"–õ–µ–∫—Åüêæ\",7],[\"Soranami\",6],[\"–ú–∏–¥–≤–µ–¥—å\",5]],\"kd_ratio\":[[\"Grey\",\"16.0\"],[\"Soranami\",\"22.67\"],[\"Toshiro\",\"15.67\"],[\"–î–∂–æ–Ω—Å–æ–Ω—é–∫\",\"15.5\"],[\"MaryKat\",\"15.0\"]],\"activity_score\":[[\"Grey\",100.0],[\"Elvina\",97.3],[\"–õ–µ–∫—Åüêæ\",97.1],[\"Soranami\",92.4],[\"–ú–∏–¥–≤–µ–¥—å\",83.0]]}";
    const TABLE = "[{\"–ò–≥—Ä–æ–∫\":\"Grey\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":2197,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":3954,\"–ß–∏—Å—Ç—ã–π PCS\":-1757,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":16,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":14,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":186,\"–ü–æ–∫—É–ø–∫–∏\":29,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":160,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":10,\"–ó–∞—Ç–æ—á–∫–∏\":12,\"–ü–æ–ª–æ–º–∫–∏\":7,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":64,\"–°–º–µ—Ä—Ç–∏\":4,\"K/D\":\"16.0\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":100.0},{\"–ò–≥—Ä–æ–∫\":\"Mizukaze\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":534,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":1469,\"–ß–∏—Å—Ç—ã–π PCS\":-935,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":0,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":0,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":48,\"–ü–æ–∫—É–ø–∫–∏\":7,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":46,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":1,\"–ó–∞—Ç–æ—á–∫–∏\":4,\"–ü–æ–ª–æ–º–∫–∏\":2,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":21,\"–°–º–µ—Ä—Ç–∏\":2,\"K/D\":\"10.5\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":18.7},{\"–ò–≥—Ä–æ–∫\":\"Toshiro\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":1105,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":1527,\"–ß–∏—Å—Ç—ã–π PCS\":-422,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":0,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":2,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":90,\"–ü–æ–∫—É–ø–∫–∏\":9,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":122,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":4,\"–ó–∞—Ç–æ—á–∫–∏\":5,\"–ü–æ–ª–æ–º–∫–∏\":3,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":47,\"–°–º–µ—Ä—Ç–∏\":3,\"K/D\":\"15.67\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":62.6},{\"–ò–≥—Ä–æ–∫\":\"–õ–µ–∫—Åüêæ\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":1790,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":3640,\"–ß–∏—Å—Ç—ã–π PCS\":-1850,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":20,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":17,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":164,\"–ü–æ–∫—É–ø–∫–∏\":28,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":166,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":12,\"–ó–∞—Ç–æ—á–∫–∏\":11,\"–ü–æ–ª–æ–º–∫–∏\":7,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":75,\"–°–º–µ—Ä—Ç–∏\":7,\"K/D\":\"10.71\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":97.1},{\"–ò–≥—Ä–æ–∫\":\"Soranami\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":1579,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":3039,\"–ß–∏—Å—Ç—ã–π PCS\":-1460,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":32,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":16,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":152,\"–ü–æ–∫—É–ø–∫–∏\":26,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":154,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":5,\"–ó–∞—Ç–æ—á–∫–∏\":7,\"–ü–æ–ª–æ–º–∫–∏\":6,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":68,\"–°–º–µ—Ä—Ç–∏\":3,\"K/D\":\"22.67\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":92.4},{\"–ò–≥—Ä–æ–∫\":\"Elvina\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":2102,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":3499,\"–ß–∏—Å—Ç—ã–π PCS\":-1397,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":13,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":9,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":183,\"–ü–æ–∫—É–ø–∫–∏\":27,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":167,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":7,\"–ó–∞—Ç–æ—á–∫–∏\":10,\"–ü–æ–ª–æ–º–∫–∏\":8,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":71,\"–°–º–µ—Ä—Ç–∏\":6,\"K/D\":\"11.83\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":97.3},{\"–ò–≥—Ä–æ–∫\":\"–î–∂–æ–Ω—Å–æ–Ω—é–∫\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":1080,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":1671,\"–ß–∏—Å—Ç—ã–π PCS\":-591,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":0,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":0,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":83,\"–ü–æ–∫—É–ø–∫–∏\":10,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":87,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":3,\"–ó–∞—Ç–æ—á–∫–∏\":3,\"–ü–æ–ª–æ–º–∫–∏\":2,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":31,\"–°–º–µ—Ä—Ç–∏\":2,\"K/D\":\"15.5\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":34.5},{\"–ò–≥—Ä–æ–∫\":\"Camalik\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":994,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":1450,\"–ß–∏—Å—Ç—ã–π PCS\":-456,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":0,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":0,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":76,\"–ü–æ–∫—É–ø–∫–∏\":10,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":94,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":3,\"–ó–∞—Ç–æ—á–∫–∏\":4,\"–ü–æ–ª–æ–º–∫–∏\":3,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":35,\"–°–º–µ—Ä—Ç–∏\":3,\"K/D\":\"11.67\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":39.4},{\"–ò–≥—Ä–æ–∫\":\"MaryKat\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":505,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":763,\"–ß–∏—Å—Ç—ã–π PCS\":-258,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":0,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":0,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":37,\"–ü–æ–∫—É–ø–∫–∏\":5,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":26,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":1,\"–ó–∞—Ç–æ—á–∫–∏\":2,\"–ü–æ–ª–æ–º–∫–∏\":1,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":15,\"–°–º–µ—Ä—Ç–∏\":1,\"K/D\":\"15.0\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":11.4},{\"–ò–≥—Ä–æ–∫\":\"–≠–º–∏–Ω\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":568,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":1230,\"–ß–∏—Å—Ç—ã–π PCS\":-662,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":0,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":0,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":38,\"–ü–æ–∫—É–ø–∫–∏\":6,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":16,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":1,\"–ó–∞—Ç–æ—á–∫–∏\":3,\"–ü–æ–ª–æ–º–∫–∏\":0,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":14,\"–°–º–µ—Ä—Ç–∏\":0,\"K/D\":\"‚àû\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":8.2},{\"–ò–≥—Ä–æ–∫\":\"–°–∫–∞–π–ª–µ—Ä\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":932,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":1482,\"–ß–∏—Å—Ç—ã–π PCS\":-550,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":0,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":0,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":73,\"–ü–æ–∫—É–ø–∫–∏\":10,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":58,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":4,\"–ó–∞—Ç–æ—á–∫–∏\":4,\"–ü–æ–ª–æ–º–∫–∏\":2,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":23,\"–°–º–µ—Ä—Ç–∏\":2,\"K/D\":\"11.5\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":28.3},{\"–ò–≥—Ä–æ–∫\":\"–ú–∏–¥–≤–µ–¥—å\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":1719,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":2409,\"–ß–∏—Å—Ç—ã–π PCS\":-690,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":0,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":0,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":162,\"–ü–æ–∫—É–ø–∫–∏\":18,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":142,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":8,\"–ó–∞—Ç–æ—á–∫–∏\":9,\"–ü–æ–ª–æ–º–∫–∏\":5,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":52,\"–°–º–µ—Ä—Ç–∏\":4,\"K/D\":\"13.0\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":83.0},{\"–ò–≥—Ä–æ–∫\":\"Didier\",\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS\":699,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PCS\":1357,\"–ß–∏—Å—Ç—ã–π PCS\":-658,\"–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PSM\":0,\"–ü–æ—Ç—Ä–∞—á–µ–Ω–æ PSM\":0,\"–î–æ–±—ã—á–∞ —Ä—É–¥—ã\":68,\"–ü–æ–∫—É–ø–∫–∏\":8,\"–í—ã–ø–∏—Ç–æ –≤ —Ç–∞–≤–µ—Ä–Ω–µ\":62,\"–ü—Ä–æ–º–æ–∫–æ–¥—ã\":4,\"–ó–∞—Ç–æ—á–∫–∏\":3,\"–ü–æ–ª–æ–º–∫–∏\":2,\"–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤\":25,\"–°–º–µ—Ä—Ç–∏\":2,\"K/D\":\"12.5\",\"–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\":31.3}]";

    const chart = JSON.parse(CHART);
    const totals = JSON.parse(TOTALS);
    const leaders = JSON.parse(LEADERS);
    const rows = JSON.parse(TABLE);

    // KPIs
    const fmt = (n) => n.toLocaleString('ru-RU');
    document.getElementById('kpi_players').textContent = fmt(totals.players);
    document.getElementById('kpi_earn_pcs').textContent = fmt(totals.earned_popscoin);
    document.getElementById('kpi_spent_pcs').textContent = fmt(totals.spent_popscoin);
    document.getElementById('kpi_net_pcs').textContent = fmt(totals.net_popscoin);
    document.getElementById('kpi_earn_psm').textContent = fmt(totals.earned_popsium);
    document.getElementById('kpi_spent_psm').textContent = fmt(totals.spent_popsium);
    document.getElementById('kpi_kills').textContent = fmt(totals.enemies_defeated);
    document.getElementById('kpi_deaths').textContent = fmt(totals.deaths);

    // Leaderboards helper
    function fillList(id, data, suffix = '') {
      const el = document.getElementById(id);
      el.innerHTML = data.map(([name, val], i) => `<li><b>#${i+1}</b> ${name} <span class="badge">${val}${suffix}</span></li>`).join('');
    }
    fillList('lead_net', leaders.net_popscoin);
    fillList('lead_earn', leaders.earned_popscoin);
    fillList('lead_psm', leaders.earned_popsium);
    fillList('lead_kills', leaders.enemies_defeated);
    fillList('lead_ores', leaders.ores_broken);
    fillList('lead_buy', leaders.purchases_made);
    fillList('lead_drink', leaders.drinks_in_tavern);
    fillList('lead_ench', leaders.enchants_used);
    fillList('lead_break', leaders.items_broken);
    fillList('lead_kd', leaders.kd_ratio);
    fillList('lead_act', leaders.activity_score);

    // Charts
    const ctxNet = document.getElementById('netChart');
    const netChart = new Chart(ctxNet, {
        type: 'bar',
        data: {
          labels: chart.players,
          datasets: [{ label: '–ß–∏—Å—Ç—ã–π PCS', data: chart.net_popscoin }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: { callbacks: { label: (ctx) => ` ${ctx.raw.toLocaleString('ru-RU')} PCS` } }
          },
          scales: {
            x: { grid: { color: 'rgba(255,255,255,.06)' } },
            y: { grid: { color: 'rgba(255,255,255,.06)' }, ticks: { callback: (v)=> v.toLocaleString('ru-RU') } }
          }
        }
    });

    const ctxPie = document.getElementById('popsiumPie');
    const pie = new Chart(ctxPie, {
      type: 'doughnut',
      data: {
        labels: chart.players,
        datasets: [{ label: 'Popsium', data: chart.earned_popsium }]
      },
      options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
    });

    const ctxStack = document.getElementById('stackedPCS');
    const stacked = new Chart(ctxStack, {
      type: 'bar',
      data: {
        labels: chart.players,
        datasets: [
          { label: '–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ', data: chart.earned_popscoin, stack: 'pcs' },
          { label: '–ü–æ—Ç—Ä–∞—á–µ–Ω–æ', data: chart.spent_popscoin, stack: 'pcs' }
        ]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'bottom' } },
        scales: { x: { stacked: true }, y: { stacked: true } }
      }
    });

    const ctxScatter = document.getElementById('scatterEarnKills');
    const scatterData = chart.players.map((p, i) => ({ x: chart.earned_popscoin[i], y: chart.enemies_defeated[i], r: Math.max(4, chart.activity_score[i]/12), label: p }));
    const scatter = new Chart(ctxScatter, {
      type: 'scatter',
      data: { datasets: [{ label: '–ò–≥—Ä–æ–∫', data: scatterData }] },
      options: {
        responsive: true,
        plugins: {
          tooltip: {
            callbacks: {
              label: (ctx) => ` ${ctx.raw.label} ‚Äî PCS: ${ctx.raw.x.toLocaleString('ru-RU')}, –ü–æ–±–µ–¥—ã: ${ctx.raw.y.toLocaleString('ru-RU')}`
            }
          }
        },
        scales: {
          x: { title: { display:true, text:'–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ PCS' } },
          y: { title: { display:true, text:'–ü–æ–±–µ–∂–¥–µ–Ω–æ –≤—Ä–∞–≥–æ–≤' } }
        }
      }
    });

    const ctxActivity = document.getElementById('activityChart');
    const activity = new Chart(ctxActivity, {
      type: 'line',
      data: {
        labels: chart.players,
        datasets: [{ label: '–ò–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏', data: chart.activity_score, tension: .3 }]
      },
      options: { responsive: true, plugins: { legend: { display: false } } }
    });

    // Table
    const thead = document.getElementById('thead');
    const tbody = document.getElementById('tbody');
    const cols = Object.keys(rows[0]);
    thead.innerHTML = '<tr>' + cols.map(c => `<th data-col="${c}">${c}</th>`).join('') + '</tr>';
    function draw(data) {
      tbody.innerHTML = data.map(r => '<tr>' + cols.map(c => `<td>${r[c]}</td>`).join('') + '</tr>').join('');
    }
    let current = rows.slice();
    draw(current);

    // Sort on header click
    thead.addEventListener('click', (e) => {
      const th = e.target.closest('th'); if(!th) return;
      const key = th.dataset.col;
      const isNumber = !isNaN(parseFloat(rows[0][key].toString().replace('‚àû','')));
      const dir = th.dataset.dir === 'asc' ? 'desc' : 'asc';
      [...thead.querySelectorAll('th')].forEach(x => x.removeAttribute('data-dir'));
      th.setAttribute('data-dir', dir);
      current.sort((a,b)=> {
        let av = a[key], bv = b[key];
        if (key==='K/D') { av = av==='‚àû' ? 1e9 : parseFloat(av); bv = b[key]==='‚àû' ? 1e9 : parseFloat(bv); }
        if (isNumber) { av = parseFloat(av); bv = parseFloat(bv); }
        if (av < bv) return dir==='asc' ? -1 : 1;
        if (av > bv) return dir==='asc' ? 1 : -1;
        return 0;
      });
      draw(current);
    });

    // Search
    const search = document.getElementById('search');
    search.addEventListener('input', () => {
      const q = search.value.toLowerCase().trim();
      current = rows.filter(r => Object.values(r).some(v => String(v).toLowerCase().includes(q)));
      draw(current);
    });

    // Export CSV
    document.getElementById('export').addEventListener('click', () => {
      const separator = ';';
      const header = cols.join(separator);
      const body = current.map(r => cols.map(c => String(r[c]).replaceAll('"','""')).join(separator)).join('\n');
      const blob = new Blob([header+'\n'+body], {type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'popscoin_stats.csv';
      a.click();
    });
  </script>
</body>
</html>
